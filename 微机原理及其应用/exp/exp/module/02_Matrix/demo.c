#include <stdio.h>
#include <fcntl.h>
#include <sys/types.h>
#include <unistd.h>
#include <string.h>
#include <pthread.h>
#include <sys/mman.h>
#include <sys/ioctl.h>
#include <sys/select.h>


struct typFNT_GB16                 // 汉字字模数据结构
{
       char Index[2];               // 汉字内码索引
       char Msk[32];                       // 点阵码数据
};

struct typFNT_GB16 GB_16[] =          // 数据表
{
"",   0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
	  
"恭", 0x04,0x00,0x04,0x20,0x22,0x24,0x19,0x24,0x00,0xA4,0x40,0x7F,0x80,0x24,0x7F,0x24,
	  0x00,0x24,0x08,0x7F,0x30,0xA4,0x09,0x24,0x32,0x24,0x04,0x24,0x04,0x20,0x00,0x00,

"喜", 0x02,0x00,0x02,0x02,0x02,0x0A,0x7A,0xEA,0x4A,0xAA,0x4B,0xAA,0x4A,0xAA,0x4A,0xAF,
	  0x4A,0xAA,0x4B,0xAA,0x4A,0xAA,0x7A,0xEA,0x02,0x0A,0x02,0x02,0x02,0x00,0x00,0x00,

"发", 0x40,0x00,0x20,0x10,0x10,0x3E,0x88,0x10,0x87,0x10,0x41,0xF0,0x46,0x9F,0x28,0x90,
	  0x10,0x90,0x28,0x92,0x27,0x94,0x40,0x1C,0xC0,0x10,0x40,0x10,0x00,0x10,0x00,0x00,

"财", 0x80,0x00,0x43,0xFE,0x20,0x02,0x18,0x02,0x07,0xFA,0x08,0x02,0x73,0xFE,0x20,0x00,
	  0x08,0x10,0x06,0x10,0x41,0x90,0x80,0x70,0x7F,0xFF,0x00,0x10,0x00,0x10,0x00,0x00,
	  
"",   0x03,0x00,0x0E,0x80,0x18,0x00,0x17,0xFE,0x2F,0xFE,0x6F,0xFE,0xF0,0x00,0xF8,0x08,
	  0xFD,0xDE,0x7E,0xEA,0x3F,0x76,0x1F,0xBE,0x00,0xC0,0x00,0x62,0x00,0x34,0x00,0x18
};

int main(int argc, char *argv[])
{
	int mem_fd,i,j,z;
	unsigned short *cpld;
	mem_fd = open("/dev/mem", O_RDWR);
	cpld = (unsigned short*)mmap(NULL,(size_t)0x20,PROT_READ | PROT_WRITE | PROT_EXEC,MAP_SHARED,mem_fd,(off_t)(0x8000000));
	if(cpld == MAP_FAILED)
		return 0;
	
	while(1)
	{
		for(z=0;z<sizeof(GB_16)/34;z++)
		for(j=0;j<16;j++)
		{
			for(i=0;i<16;i++)
			{
				if(i < 16-j)
					*(cpld+((0xc0+i)<<1)) = ((GB_16[z].Msk[(i+j)*2]<<8) + (GB_16[z].Msk[(i+j)*2+1]));   //数码管
				else
					*(cpld+((0xc0+i)<<1)) = ((GB_16[z+1].Msk[(i-(16-j))*2]<<8) + (GB_16[z+1].Msk[(i-(16-j))*2+1]));   //数码管
			}
			usleep(200000);
		}
	}
	
	munmap(cpld,0x20);
	close(mem_fd);
	return 0;
}
